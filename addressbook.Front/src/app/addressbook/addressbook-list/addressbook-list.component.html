<div class="addressbook-container">
  <div class="header">
    <h1>Address Book</h1>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="onExport()">Export to Excel</button>
      <button class="btn btn-primary" (click)="onAdd()">Add New Entry</button>
    </div>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <h3>Search</h3>
    <div class="search-form">
      <div class="form-row">
        <div class="form-group">
          <label>Search Term</label>
          <input type="text" [(ngModel)]="searchFilter.searchTerm" placeholder="Search by name, email, mobile, or address" />
        </div>
        <div class="form-group">
          <label>Start Date</label>
          <input type="date" [(ngModel)]="searchFilter.startDate" />
        </div>
        <div class="form-group">
          <label>End Date</label>
          <input type="date" [(ngModel)]="searchFilter.endDate" />
        </div>
      </div>
      <div class="search-actions">
        <button class="btn btn-primary" (click)="onSearch()">Search</button>
        <button class="btn btn-secondary" (click)="onClearSearch()">Clear</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">Loading...</div>

  <!-- Table -->
  <div class="table-container" *ngIf="!isLoading">
    <table class="data-table">
      <thead>
        <tr>
          <th>Photo</th>
          <th>Full Name</th>
          <th>Job Title</th>
          <th>Department</th>
          <th>Mobile</th>
          <th>Email</th>
          <th>Date of Birth</th>
          <th>Age</th>
          <th>Address</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let entry of filteredAddressBooks">
          <td>
            <img *ngIf="entry.photoPath" [src]="entry.photoPath" alt="Photo" class="photo-thumbnail" />
            <span *ngIf="!entry.photoPath" class="no-photo">No Photo</span>
          </td>
          <td>{{ entry.fullName }}</td>
          <td>{{ getJobTitle(entry.jobId) }}</td>
          <td>{{ getDepartmentName(entry.departmentId) }}</td>
          <td>{{ entry.mobileNumber }}</td>
          <td>{{ entry.email }}</td>
          <td>{{ entry.dateOfBirth | date:'shortDate' }}</td>
          <td>{{ entry.age }}</td>
          <td>{{ entry.address }}</td>
          <td>
            <button class="btn btn-sm btn-edit" (click)="onEdit(entry)">Edit</button>
            <button class="btn btn-sm btn-delete" (click)="onDelete(entry.id!)">Delete</button>
          </td>
        </tr>
        <tr *ngIf="filteredAddressBooks.length === 0">
          <td colspan="10" class="no-data">No entries found</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Edit Modal -->
  <app-addressbook-edit
    *ngIf="showEditModal"
    [entry]="selectedEntry"
    [jobs]="jobs"
    [departments]="departments"
    (close)="onModalClose()"
    (save)="onModalSave()"
  ></app-addressbook-edit>
</div>

